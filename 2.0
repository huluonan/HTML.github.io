<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>贪吃蛇小游戏</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #000;
    font-family: Arial, sans-serif;
    flex-direction: column;
    color: #0f0;
  }
  canvas {
    border: 4px solid #0f0;
    box-shadow: 0 0 20px #0f0;
  }
  #score {
    margin-top: 20px;
    font-size: 24px;
  }
  #gameOver {
    position: absolute;
    font-size: 50px;
    color: red;
    display: none;
  }
</style>
</head>
<body>

<canvas id="canvas" width="400" height="400"></canvas>
<div id="score">分数: 0</div>
<div id="gameOver">游戏结束！按 F5 重新开始</div>

<script>
// 基本设置
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');
const gameOverElement = document.getElementById('gameOver');

const grid = 20;                    // 每个格子大小
let count = 0;

let snake = [
  {x: 200, y: 200},
  {x: 180, y: 200},
  {x: 160, y: 200}
];

let dx = grid;   // 初始向右
let dy =  = 0;
let foodX, foodY;
let score = 0;
let changingDirection = false;
let gameLoop;

// 生成随机食物
function randomFood() {
  foodX = Math.floor(Math.random() * (canvas.width / grid)) * grid;
  foodY = Math.floor(Math.random() * (canvas.height / grid)) * grid;
  
  // 避免食物生成在蛇身上
  for (let segment of snake) {
    if (segment.x === foodX && segment.y === foodY) {
      randomFood();
      return;
    }
  }
}

// 主游戏循环
function main() {
  if (hasGameEnded()) {
    gameOverElement.style.display = 'block';
    return;
  }

  changingDirection = false;
  setTimeout(function() {
    clearCanvas();
    drawFood();
    moveSnake();
    drawSnake();
    main();
  }, 100); // 速度（越小越快）
}

// 清空画布
function clearCanvas() {
  ctx.fillStyle = 'black';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// 绘制蛇
function drawSnake() {
  snake.forEach((segment, index) => {
    ctx.fillStyle = index === 0 ? '#0f0' : '#0a0';
    ctx.fillRect(segment.x, segment.y, grid, grid);
    
    ctx.strokeStyle = '#000';
    ctx.strokeRect(segment.x, segment.y, grid, grid);
  });
}

// 移动蛇
function moveSnake() {
  const head = {x: snake[0].x + dx, y: snake[0].y + dy};

  // 穿墙效果
  if (head.x >= canvas.width) head.x = 0;
  if (head.x < 0) head.x = canvas.width - grid;
  if (head.y >= canvas.height) head.y = 0;
  if (head.y < 0) head.y = canvas.height - grid;

  snake.unshift(head);

  // 吃到食物？
  if (head.x === foodX && head.y === foodY) {
    score += 10;
    scoreElement.textContent = `分数: ${score}`;
    randomFood();
  } else {
    snake.pop();
  }
}

// 绘制食物
function drawFood() {
  ctx.fillStyle = 'red';
  ctx.beginPath();
  ctx.arc(foodX + grid/2, foodY + grid/2, grid/2, 0, Math.PI * 2);
  ctx.fill();
}

// 检测游戏是否结束（撞到自己）
function hasGameEnded() {
  for (let i = 4; i < snake.length; i++) {
    if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
      return true;
    }
  }
  return false;
}

// 键盘控制
document.addEventListener('keydown', e => {
  if (changingDirection) return;
  changingDirection = true;

  const LEFT  = 37, UP = 38, RIGHT = 39, DOWN = 40;
  const key = e.keyCode;

  // 防止掉头直接撞自己
  if (key === LEFT  && dx !== grid)   { dx = -grid; dy = 0; }
  if (key === UP    && dy !== grid)   { dx = 0;    dy = -grid; }
  if (key === RIGHT && dx !== -grid)  { dx = grid; dy = 0; }
  if (key === DOWN  && dy !== -grid)  { dx = 0;    dy = grid; }
});

// 开始游戏
randomFood();
main();

</script>
</body>
</html>
